<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Launcher - ‰øÆÊ≠£Ë¶ÅÊ±Ç„ÉÜ„Çπ„Éà</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .test-section h3 {
            color: #333;
            margin-top: 0;
        }
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            resize: vertical;
            margin-bottom: 10px;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        button:hover {
            background: #5a6fd8;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        .action-card {
            display: inline-block;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin: 5px;
            text-decoration: none;
            color: #333;
            min-width: 120px;
            text-align: center;
        }
        .action-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        .action-title {
            font-weight: bold;
            margin-bottom: 4px;
        }
        .action-description {
            font-size: 12px;
            color: #666;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Focus Launcher - ‰øÆÊ≠£Ë¶ÅÊ±Ç„ÉÜ„Çπ„Éà</h1>
        
        <div class="test-section">
            <h3>1. „ÉØ„Éº„ÇØ„Éï„É≠„ÉºÈñãÂßã„ÉÜ„Çπ„Éà</h3>
            <textarea id="workflow-input" placeholder="‰ΩúÊ•≠ÁõÆÁöÑ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà‰æãÔºöÁ†îÁ©∂Ë®àÁîªÊõ∏„ÇíÊõ∏„ÅèÔºâ" rows="3"></textarea>
            <button onclick="startWorkflow()" id="start-btn">
                <span id="start-loading" class="loading" style="display: none;"></span>
                „ÉØ„Éº„ÇØ„Éï„É≠„ÉºÈñãÂßã
            </button>
            <div id="workflow-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>2. ‰øÆÊ≠£Ë¶ÅÊ±Ç„ÉÜ„Çπ„Éà</h3>
            <textarea id="feedback-input" placeholder="‰øÆÊ≠£Ë¶ÅÊ±Ç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà‰æãÔºöGoogle Slides„ÇíËøΩÂä†„Åó„Å¶Ôºâ" rows="3"></textarea>
            <button onclick="submitFeedback()" id="feedback-btn">
                <span id="feedback-loading" class="loading" style="display: none;"></span>
                ‰øÆÊ≠£Ë¶ÅÊ±ÇÈÄÅ‰ø°
            </button>
            <button onclick="clearFeedback()">„ÇØ„É™„Ç¢</button>
            <div id="feedback-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>3. ÁèæÂú®„ÅÆ„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÁä∂ÊÖã</h3>
            <button onclick="showCurrentWorkflow()">ÁèæÂú®„ÅÆÁä∂ÊÖã„ÇíË°®Á§∫</button>
            <button onclick="clearWorkflow()">„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÁµÇ‰∫Ü</button>
            <div id="current-state" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>4. „Ç¢„ÇØ„Ç∑„Éß„É≥Ë°®Á§∫„ÉÜ„Çπ„Éà</h3>
            <div id="actions-display"></div>
        </div>
    </div>

    <script>
        // „É¢„ÉÉ„ÇØ„ÅÆFocusLauncher„ÇØ„É©„Çπ
        class MockFocusLauncher {
            constructor() {
                this.currentWorkflow = null;
                this.loadCurrentWorkflow();
            }

            // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Çí‰ΩøÁî®ÔºàChromeÊã°ÂºµÊ©üËÉΩAPI„ÅÆ‰ª£ÊõøÔºâ
            async setStorage(data) {
                localStorage.setItem('currentWorkflow', JSON.stringify(data));
            }

            async getStorage() {
                const data = localStorage.getItem('currentWorkflow');
                return data ? { currentWorkflow: JSON.parse(data) } : {};
            }

            async removeStorage() {
                localStorage.removeItem('currentWorkflow');
            }

            async loadCurrentWorkflow() {
                try {
                    const result = await this.getStorage();
                    console.log('„Çπ„Éà„É¨„Éº„Ç∏„Åã„ÇâÂèñÂæó„Åó„Åü„Éá„Éº„Çø:', result);
                    
                    if (result.currentWorkflow && result.currentWorkflow.text) {
                        this.currentWorkflow = result.currentWorkflow;
                        console.log('Êó¢Â≠ò„ÅÆ„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÇíÂæ©ÂÖÉ„Åó„Åæ„Åó„Åü:', this.currentWorkflow.text);
                        this.displayActions();
                    } else {
                        console.log('Êñ∞„Åó„ÅÑ„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÇíÈñãÂßã„Åó„Åæ„Åô');
                    }
                } catch (error) {
                    console.error('„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
                }
            }

            async startWorkflow() {
                const workflowText = document.getElementById('workflow-input').value.trim();
                
                if (!workflowText) {
                    alert('‰ΩúÊ•≠ÁõÆÁöÑ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                this.showLoading('start');

                try {
                    // „É¢„ÉÉ„ÇØAI„É¨„Çπ„Éù„É≥„Çπ„ÇíÁîüÊàê
                    const aiResponse = this.generateMockAIResponse(workflowText);
                    
                    this.currentWorkflow = {
                        ...this.currentWorkflow,
                        aiContent: aiResponse
                    };

                    // „Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
                    await this.setStorage(this.currentWorkflow);

                    this.hideLoading('start');
                    this.displayWorkflowResult();
                    this.displayActions();

                    console.log('Êñ∞„Åó„ÅÑ„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü:', workflowText);

                } catch (error) {
                    console.error('„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÅÆÈñãÂßã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
                    alert('„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÅÆÈñãÂßã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    this.hideLoading('start');
                }
            }

            async submitFeedback() {
                const feedbackText = document.getElementById('feedback-input').value.trim();
                
                if (!feedbackText) {
                    alert('‰øÆÊ≠£Ë¶ÅÊ±Ç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                if (!this.currentWorkflow) {
                    alert('„Åæ„Åö„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                // „ÉØ„Éº„ÇØ„Éï„É≠„ÉºÁµÇ‰∫Ü„ÅÆË¶ÅÊ±Ç„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                if (feedbackText.toLowerCase().includes('„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÇíÁµÇ‰∫Ü') || 
                    feedbackText.toLowerCase().includes('ÁµÇ‰∫Ü') ||
                    feedbackText.toLowerCase().includes('„ÇÑ„ÇÅ„Çã')) {
                    this.clearWorkflow();
                    return;
                }

                this.showLoading('feedback');

                try {
                    console.log('‰øÆÊ≠£Ë¶ÅÊ±Ç„ÇíÂèó‰ø°:', feedbackText);

                    // ‰øÆÊ≠£Ë¶ÅÊ±Ç„ÇíÂá¶ÁêÜ
                    const updatedActions = await this.processFeedbackRequest(feedbackText);
                    
                    console.log('Êõ¥Êñ∞„Åï„Çå„Åü„Ç¢„ÇØ„Ç∑„Éß„É≥:', updatedActions);
                    
                    // Êó¢Â≠ò„ÅÆAI„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÊõ¥Êñ∞
                    const updatedAiContent = {
                        ...this.currentWorkflow.aiContent,
                        actions: updatedActions
                    };
                    
                    this.currentWorkflow = {
                        ...this.currentWorkflow,
                        aiContent: updatedAiContent,
                        feedback: feedbackText
                    };

                    // „Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
                    await this.setStorage(this.currentWorkflow);

                    this.hideLoading('feedback');
                    this.displayFeedbackResult();
                    this.displayActions();

                    // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„Çí„ÇØ„É™„Ç¢
                    document.getElementById('feedback-input').value = '';

                    console.log('‰øÆÊ≠£Ë¶ÅÊ±Ç„ÇíÂá¶ÁêÜ„Åó„Åæ„Åó„Åü:', feedbackText);

                } catch (error) {
                    console.error('‰øÆÊ≠£Ë¶ÅÊ±Ç„ÅÆÂá¶ÁêÜ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
                    alert('‰øÆÊ≠£Ë¶ÅÊ±Ç„ÅÆÂá¶ÁêÜ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    this.hideLoading('feedback');
                }
            }

            async processFeedbackRequest(feedbackText) {
                const existingActions = this.currentWorkflow.aiContent.actions;
                console.log('Êó¢Â≠ò„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥:', existingActions);
                
                // ÂâäÈô§Ë¶ÅÊ±Ç„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                const removeRequests = this.extractRemoveRequests(feedbackText);
                console.log('ÂâäÈô§Ë¶ÅÊ±Ç:', removeRequests);
                
                let filteredActions = existingActions.filter(action => 
                    !removeRequests.some(remove => 
                        action.title.toLowerCase().includes(remove.toLowerCase()) ||
                        action.description.toLowerCase().includes(remove.toLowerCase())
                    )
                );

                console.log('ÂâäÈô§Âæå„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥:', filteredActions);

                // ËøΩÂä†Ë¶ÅÊ±Ç„ÇíÂá¶ÁêÜ
                const addRequests = this.extractAddRequests(feedbackText);
                console.log('ËøΩÂä†Ë¶ÅÊ±Ç:', addRequests);
                
                if (addRequests.length > 0) {
                    const newActions = await this.generateAdditionalActions(addRequests);
                    console.log('Êñ∞„Åó„ÅèËøΩÂä†„Åï„Çå„Çã„Ç¢„ÇØ„Ç∑„Éß„É≥:', newActions);
                    filteredActions = [...filteredActions, ...newActions];
                }

                return filteredActions;
            }

            extractRemoveRequests(feedbackText) {
                const removeKeywords = ['ÂâäÈô§', 'Ââä„Å£„Å¶', 'Âèñ„ÇäÈô§„ÅÑ„Å¶', '‰∏çË¶Å', '„ÅÑ„Çâ„Å™„ÅÑ', 'Ê∂à„Åó„Å¶'];
                const words = feedbackText.split(/[„ÄÅ„ÄÇ\s]+/);
                return words.filter(word => 
                    removeKeywords.some(keyword => word.includes(keyword))
                );
            }

            extractAddRequests(feedbackText) {
                const addKeywords = ['ËøΩÂä†', 'Âä†„Åà„Å¶', 'ÂÖ•„Çå„Å¶', 'Âê´„ÇÅ„Å¶', 'Â¢ó„ÇÑ„Åó„Å¶'];
                const words = feedbackText.split(/[„ÄÅ„ÄÇ\s]+/);
                return words.filter(word => 
                    addKeywords.some(keyword => word.includes(keyword))
                );
            }

            async generateAdditionalActions(requests) {
                const additionalActions = [];
                
                for (const request of requests) {
                    if (request.includes('Google') || request.includes('„Ç∞„Éº„Ç∞„É´')) {
                        if (request.includes('Docs') || request.includes('„Éâ„Ç≠„É•„É°„É≥„Éà')) {
                            additionalActions.push({
                                title: 'Google Docs',
                                description: 'ÊñáÊõ∏‰ΩúÊàê',
                                url: 'https://docs.google.com',
                                icon: 'üìÑ'
                            });
                        } else if (request.includes('Slides') || request.includes('„Éó„É¨„Çº„É≥')) {
                            additionalActions.push({
                                title: 'Google Slides',
                                description: '„Éó„É¨„Çº„É≥„ÉÜ„Éº„Ç∑„Éß„É≥',
                                url: 'https://slides.google.com',
                                icon: 'üìä'
                            });
                        } else if (request.includes('Sheets') || request.includes('„Çπ„Éó„É¨„ÉÉ„Éâ')) {
                            additionalActions.push({
                                title: 'Google Sheets',
                                description: '„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà',
                                url: 'https://sheets.google.com',
                                icon: 'üìà'
                            });
                        }
                    } else if (request.includes('ChatGPT') || request.includes('chatgpt')) {
                        additionalActions.push({
                            title: 'ChatGPT',
                            description: 'AI„Ç¢„Ç∑„Çπ„Çø„É≥„Éà',
                            url: 'https://chat.openai.com',
                            icon: 'ü§ñ'
                        });
                    } else if (request.includes('Notion') || request.includes('notion')) {
                        additionalActions.push({
                            title: 'Notion',
                            description: '„Éé„Éº„Éà„Éª„Éó„É≠„Ç∏„Çß„ÇØ„ÉàÁÆ°ÁêÜ',
                            url: 'https://www.notion.so',
                            icon: 'üìù'
                        });
                    } else if (request.includes('Slack') || request.includes('slack')) {
                        additionalActions.push({
                            title: 'Slack',
                            description: '„ÉÅ„Éº„É†„Ç≥„Éü„É•„Éã„Ç±„Éº„Ç∑„Éß„É≥',
                            url: 'https://slack.com',
                            icon: 'üí¨'
                        });
                    } else if (request.includes('Zoom') || request.includes('zoom')) {
                        additionalActions.push({
                            title: 'Zoom',
                            description: '„Ç™„É≥„É©„Ç§„É≥‰ºöË≠∞',
                            url: 'https://zoom.us',
                            icon: 'üìπ'
                        });
                    }
                }
                
                return additionalActions;
            }

            generateMockAIResponse(workflowText) {
                return {
                    title: '„ÉÜ„Çπ„Éà„ÉØ„Éº„ÇØ„Éï„É≠„Éº',
                    content: '<p>„ÉÜ„Çπ„ÉàÁî®„ÅÆ„ÉØ„Éº„ÇØ„Éï„É≠„Éº„Åß„Åô„ÄÇ</p>',
                    actions: [
                        {
                            title: 'Google Docs',
                            description: 'ÊñáÊõ∏‰ΩúÊàê',
                            url: 'https://docs.google.com',
                            icon: 'üìÑ'
                        },
                        {
                            title: 'GitHub',
                            description: '„Ç≥„Éº„ÉâÁÆ°ÁêÜ',
                            url: 'https://github.com',
                            icon: 'üíª'
                        }
                    ]
                };
            }

            showLoading(type) {
                const loadingElement = document.getElementById(`${type}-loading`);
                const button = document.getElementById(`${type}-btn`);
                if (loadingElement && button) {
                    loadingElement.style.display = 'inline-block';
                    button.disabled = true;
                }
            }

            hideLoading(type) {
                const loadingElement = document.getElementById(`${type}-loading`);
                const button = document.getElementById(`${type}-btn`);
                if (loadingElement && button) {
                    loadingElement.style.display = 'none';
                    button.disabled = false;
                }
            }

            displayWorkflowResult() {
                const resultDiv = document.getElementById('workflow-result');
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    <strong>„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÈñãÂßãÊàêÂäüÔºÅ</strong><br>
                    „ÉÜ„Ç≠„Çπ„Éà: ${this.currentWorkflow.text}<br>
                    „Çø„Ç§„É†„Çπ„Çø„É≥„Éó: ${new Date(this.currentWorkflow.timestamp).toLocaleString()}
                `;
            }

            displayFeedbackResult() {
                const resultDiv = document.getElementById('feedback-result');
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    <strong>‰øÆÊ≠£Ë¶ÅÊ±ÇÂá¶ÁêÜÊàêÂäüÔºÅ</strong><br>
                    „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ: ${this.currentWorkflow.feedback}<br>
                    „Ç¢„ÇØ„Ç∑„Éß„É≥Êï∞: ${this.currentWorkflow.aiContent.actions.length}ÂÄã
                `;
            }

            displayActions() {
                const actionsDiv = document.getElementById('actions-display');
                if (!this.currentWorkflow) {
                    actionsDiv.innerHTML = '<p>„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÅåÈñãÂßã„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>';
                    return;
                }
                
                actionsDiv.innerHTML = '<h4>ÁèæÂú®„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥:</h4>';
                
                this.currentWorkflow.aiContent.actions.forEach(action => {
                    const actionCard = document.createElement('div');
                    actionCard.className = 'action-card';
                    actionCard.innerHTML = `
                        <div class="action-icon">${action.icon}</div>
                        <div class="action-title">${action.title}</div>
                        <div class="action-description">${action.description}</div>
                    `;
                    actionsDiv.appendChild(actionCard);
                });
            }

            async clearWorkflow() {
                this.currentWorkflow = null;
                await this.removeStorage();
                
                document.getElementById('workflow-result').style.display = 'none';
                document.getElementById('feedback-result').style.display = 'none';
                document.getElementById('current-state').style.display = 'none';
                document.getElementById('actions-display').innerHTML = '<p>„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÅåÈñãÂßã„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>';
                
                alert('„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÇíÁµÇ‰∫Ü„Åó„Åæ„Åó„Åü');
            }

            async showCurrentWorkflow() {
                const result = await this.getStorage();
                const stateDiv = document.getElementById('current-state');
                stateDiv.style.display = 'block';
                
                if (result.currentWorkflow) {
                    stateDiv.innerHTML = `
                        <strong>ÁèæÂú®„ÅÆ„ÉØ„Éº„ÇØ„Éï„É≠„Éº:</strong><br>
                        „ÉÜ„Ç≠„Çπ„Éà: ${result.currentWorkflow.text}<br>
                        „Çø„Ç§„É†„Çπ„Çø„É≥„Éó: ${new Date(result.currentWorkflow.timestamp).toLocaleString()}<br>
                        „Ç¢„ÇØ„Ç∑„Éß„É≥Êï∞: ${result.currentWorkflow.aiContent.actions.length}ÂÄã
                    `;
                    this.currentWorkflow = result.currentWorkflow;
                    this.displayActions();
                } else {
                    stateDiv.innerHTML = '<strong>„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÅØÈñãÂßã„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</strong>';
                }
            }
        }

        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let mockLauncher;

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            mockLauncher = new MockFocusLauncher();
        });

        // „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞
        function startWorkflow() {
            mockLauncher.startWorkflow();
        }

        function submitFeedback() {
            mockLauncher.submitFeedback();
        }

        function clearFeedback() {
            document.getElementById('feedback-input').value = '';
            document.getElementById('feedback-result').style.display = 'none';
        }

        function showCurrentWorkflow() {
            mockLauncher.showCurrentWorkflow();
        }

        function clearWorkflow() {
            mockLauncher.clearWorkflow();
        }
    </script>
</body>
</html> 